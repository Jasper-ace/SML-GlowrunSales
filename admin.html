<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <script src="404-handler.js"></script>
  <title>Admin Dashboard</title>
  <link rel="icon" type="image/x-icon" href="favicon.ico?v=3">
  <link rel="icon" type="image/png" sizes="64x64" href="assets/green.png?v=3">
  <link rel="icon" type="image/png" sizes="32x32" href="assets/green.png?v=3">
  <link rel="icon" type="image/png" sizes="16x16" href="assets/green.png?v=3">
  <link rel="apple-touch-icon" sizes="180x180" href="assets/green.png">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link href="style.css" rel="stylesheet">
</head>

<body class="bg-light">

  <!-- Floating Background Shapes -->
  <div class="floating-shapes">
    <div class="shape shape-1"></div>
    <div class="shape shape-2"></div>
    <div class="shape shape-3"></div>
    <div class="shape shape-4"></div>
    <div class="shape shape-5"></div>
    <div class="shape shape-6"></div>
  </div>

  <!-- Top Navbar -->
  <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm sticky-top">
    <div class="container-fluid">
      <div class="navbar-brand fw-bold d-flex align-items-center">
        <span style="font-size: 1.5rem; margin-right: 0.5rem;">üëë</span>
        <span style="font-size: 1.25rem;" class="d-none d-md-inline">Super Admin Dashboard</span>
        <span style="font-size: 1rem;" class="d-inline d-md-none">Admin</span>
      </div>
      <div class="d-flex align-items-center gap-2 gap-md-3">
        <div class="d-flex align-items-center" id="userProfile">
          <img id="userPhoto" class="rounded-circle me-2" src="https://via.placeholder.com/40" alt="Profile" width="40"
            height="40">
          <span id="userName" class="fw-bold d-none d-sm-inline"></span>
        </div>
        <a href="dashboard.html" class="btn btn-outline-primary btn-sm d-none d-sm-inline-block">
          <span style="font-size: 0.9rem;">üìä</span> Dashboard
        </a>
        <a href="dashboard.html" class="btn btn-outline-primary btn-sm d-inline-block d-sm-none">
          üìä
        </a>
        <button id="logoutBtn" class="btn btn-danger btn-sm">
          <span style="font-size: 0.9rem;" class="d-none d-sm-inline">üö™</span>
          <span class="d-inline d-sm-none">üö™</span>
          <span class="d-none d-sm-inline"> Logout</span>
        </button>
      </div>
    </div>
  </nav>

  <div class="container-fluid py-4">

    <!-- Stats Cards -->
    <div class="row g-4 mb-4">
      <div class="col-md-3">
        <div class="card admin-stat-card shadow border-0 rounded-3">
          <div class="card-body text-center">
            <div class="stat-icon mb-3">üì¶</div>
            <h3 id="totalEntries" class="stat-number mb-1">0</h3>
            <p class="stat-label mb-0">Total Entries</p>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card admin-stat-card shadow border-0 rounded-3">
          <div class="card-body text-center">
            <div class="stat-icon mb-3">üí∞</div>
            <h3 id="totalRevenue" class="stat-number mb-1">‚Ç±0</h3>
            <p class="stat-label mb-0">Total Revenue</p>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card admin-stat-card shadow border-0 rounded-3 clickable-card" onclick="showOnlineUsers()">
          <div class="card-body text-center">
            <div class="stat-icon mb-3">üë•</div>
            <h3 id="totalUsers" class="stat-number mb-1">0</h3>
            <p class="stat-label mb-0">Online Users</p>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card admin-stat-card shadow border-0 rounded-3">
          <div class="card-body text-center">
            <div class="stat-icon mb-3">üìà</div>
            <h3 id="todayEntries" class="stat-number mb-1">0</h3>
            <p class="stat-label mb-0">Today's Sales</p>
          </div>
        </div>
      </div>
    </div>

    <div class="row g-4">

      <!-- User Management -->
      <div class="col-lg-6">
        <div class="card shadow border-0 rounded-3">
          <div class="card-body">
            <h5 class="card-title">
              <span style="font-size: 1.25rem;">üë•</span>
              User Management
            </h5>

            <div class="mb-3">
              <input type="text" id="userSearch" class="form-control" placeholder="üîç Search users...">
            </div>

            <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
              <table class="table table-hover admin-table">
                <thead class="text-center">
                  <tr>
                    <th>Email</th>
                    <th>Name</th>
                    <th>Role</th>
                    <th>Last Activity</th>
                    <th>Entries</th>
                    <th>Total Sales</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="userTableBody">
                  <!-- Dynamic content -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- Department Analytics -->
      <div class="col-lg-6">
        <div class="card shadow border-0 rounded-3">
          <div class="card-body">
            <h5 class="card-title">
              <span style="font-size: 1.25rem;">üè¢</span>
              Department Analytics
            </h5>

            <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
              <table class="table table-hover admin-table">
                <thead class="text-center">
                  <tr>
                    <th>Department</th>
                    <th>Entries</th>
                    <th>Quantity</th>
                    <th>Revenue</th>
                  </tr>
                </thead>
                <tbody id="deptTableBody">
                  <!-- Dynamic content -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- Sales Chart -->
      <div class="col-12">
        <div class="card shadow border-0 rounded-3">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <h5 class="card-title mb-0">
                <span style="font-size: 1.25rem;">üìä</span>
                Sales Analytics
              </h5>
              <div class="d-flex align-items-center gap-2">
                <button id="chartPrevWeek" class="btn btn-sm btn-outline-primary">
                  ‚Üê Previous
                </button>
                <span id="chartDateRange" class="fw-bold text-muted" style="min-width: 200px; text-align: center;">
                  Last 7 Days
                </span>
                <button id="chartNextWeek" class="btn btn-sm btn-outline-primary">
                  Next ‚Üí
                </button>
                <button id="chartToday" class="btn btn-sm btn-primary">
                  Today
                </button>
              </div>
            </div>
            <div style="position: relative; height: 300px;">
              <canvas id="salesChart"></canvas>
            </div>
          </div>
        </div>
      </div>

      <!-- Recently Deleted -->
      <div class="col-12">
        <div class="card shadow border-0 rounded-3">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <h5 class="card-title mb-0">
                <span style="font-size: 1.25rem;">üóëÔ∏è</span>
                Recently Deleted
              </h5>
              <button id="clearDeletedBtn" class="btn btn-sm btn-outline-danger">
                <span style="font-size: 0.9rem;">üî•</span> Clear All
              </button>
            </div>

            <div class="mb-3">
              <input type="text" id="deletedSearch" class="form-control"
                placeholder="üîç Search by ID Number, Ticket Number, or Name...">
            </div>

            <div class="table-responsive" style="max-height: 350px; overflow-y: auto;">
              <table class="table table-striped table-hover admin-table">
                <thead class="text-center">
                  <tr>
                    <th>No.</th>
                    <th>School ID</th>
                    <th>Ticket Number</th>
                    <th>Name</th>
                    <th>Department</th>
                    <th>Quantity</th>
                    <th>Total Price</th>
                    <th>Deleted By</th>
                    <th>Deleted At</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="deletedTableBody">
                  <!-- Dynamic content -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- Recent Activity -->
      <div class="col-12">
        <div class="card shadow border-0 rounded-3">
          <div class="card-body">
            <h5 class="card-title">
              <span style="font-size: 1.25rem;">üïí</span>
              Recent Activity
            </h5>

            <div class="row mb-3 g-2">
              <div class="col-md-4">
                <input type="text" id="activitySearch" class="form-control"
                  placeholder="üîç Search by ID Number, Ticket Number, or Name...">
              </div>
              <div class="col-md-3">
                <select id="activityFilter" class="form-select">
                  <option value="all">All Activities</option>
                  <option value="today">Today</option>
                  <option value="week">This Week</option>
                  <option value="month">This Month</option>
                </select>
              </div>
              <div class="col-md-3">
                <select id="activityUser" class="form-select">
                  <option value="">All Users</option>
                </select>
              </div>
            </div>

            <div class="table-responsive" style="max-height: 450px; overflow-y: auto;">
              <table class="table table-striped table-hover admin-table">
                <thead class="text-center">
                  <tr>
                    <th>No.</th>
                    <th>School ID</th>
                    <th>Ticket Number</th>
                    <th>Name</th>
                    <th>Department</th>
                    <th>Quantity</th>
                    <th>Total Price</th>
                    <th>Sold By</th>
                    <th>Timestamp</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="activityTableBody">
                  <!-- Dynamic content -->
                </tbody>
              </table>
            </div>

            <!-- Activity Pagination Controls -->
            <div id="activityPaginationContainer" class="d-flex justify-content-between align-items-center p-3 bg-light border-top" style="display: none !important;">
              <div class="d-flex align-items-center">
                <span class="text-muted me-3">
                  Showing <span id="activityShowingStart">1</span> to <span id="activityShowingEnd">10</span> of <span id="activityTotalEntries">0</span> activities
                </span>
              </div>
              <div class="d-flex align-items-center gap-2">
                <button id="activityPrevPageBtn" class="btn btn-outline-primary btn-sm" disabled>
                  <span style="font-size: 0.8rem;">‚Üê</span> Previous
                </button>
                <div id="activityPageNumbers" class="d-flex gap-1">
                  <!-- Page numbers will be inserted here -->
                </div>
                <button id="activityNextPageBtn" class="btn btn-outline-primary btn-sm" disabled>
                  Next <span style="font-size: 0.8rem;">‚Üí</span>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- View Tickets Modal -->
  <div class="modal fade" id="adminViewTicketsModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content rounded-3 shadow">
        <div class="modal-header" style="background: linear-gradient(135deg, #7c3aed 0%, #a78bfa 100%);">
          <h5 class="modal-title text-white">
            <span style="font-size: 1.1rem;">üé´</span> View Tickets
          </h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div id="adminViewTicketsContent">
            <!-- Ticket details will be inserted here -->
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Online Users Modal -->
  <div class="modal fade" id="onlineUsersModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content rounded-3 shadow">
        <div class="modal-header">
          <h5 class="modal-title">
            <span style="font-size: 1.1rem;">üë•</span> Online Users
          </h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body" id="onlineUsersBody" style="max-height: 400px; overflow-y: auto;">
          <!-- Dynamic content -->
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div class="modal fade" id="deleteModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content rounded-3 shadow">
        <div class="modal-header" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">
          <h5 class="modal-title">
            <span style="font-size: 1.1rem;">‚ö†Ô∏è</span> Confirm Delete
          </h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body text-center py-4">
          <div style="font-size: 3rem; margin-bottom: 1rem;">üóëÔ∏è</div>
          <p class="fw-bold fs-5 mb-2">Are you sure you want to delete this entry?</p>
          <p class="text-muted mb-0">You can restore it from Recently Deleted.</p>
        </div>
        <div class="modal-footer justify-content-center">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" id="confirmDeleteBtn" class="btn btn-danger">Delete Entry</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Permanent Delete Confirmation Modal -->
  <div class="modal fade" id="permanentDeleteModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content rounded-3 shadow">
        <div class="modal-header" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">
          <h5 class="modal-title">
            <span style="font-size: 1.1rem;">üî•</span> Confirm Permanent Delete
          </h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body text-center py-4">
          <div style="font-size: 3rem; margin-bottom: 1rem;">üî•</div>
          <p class="fw-bold fs-5 mb-2">Permanently delete this entry?</p>
          <p class="text-muted mb-0">This action CANNOT be undone!</p>
        </div>
        <div class="modal-footer justify-content-center">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" id="confirmPermanentDeleteBtn" class="btn btn-danger">Delete Permanently</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Restore Confirmation Modal -->
  <div class="modal fade" id="restoreModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content rounded-3 shadow">
        <div class="modal-header" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
          <h5 class="modal-title">
            <span style="font-size: 1.1rem;">‚ôªÔ∏è</span> Confirm Restore
          </h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body text-center py-4">
          <div style="font-size: 3rem; margin-bottom: 1rem;">‚ôªÔ∏è</div>
          <p class="fw-bold fs-5 mb-2">Restore this entry?</p>
          <p class="text-muted mb-0">This will move the entry back to active records.</p>
        </div>
        <div class="modal-footer justify-content-center">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" id="confirmRestoreBtn" class="btn btn-success">Restore Entry</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Clear All Deleted Modal -->
  <div class="modal fade" id="clearAllModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content rounded-3 shadow">
        <div class="modal-header" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">
          <h5 class="modal-title">
            <span style="font-size: 1.1rem;">üî•</span> Clear All Deleted
          </h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body text-center py-4">
          <div style="font-size: 3rem; margin-bottom: 1rem;">üî•</div>
          <p class="fw-bold fs-5 mb-2">Permanently delete all entries?</p>
          <p class="text-muted mb-0">This action cannot be undone!</p>
        </div>
        <div class="modal-footer justify-content-center">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" id="confirmClearAllBtn" class="btn btn-danger">Delete Permanently</button>
        </div>
      </div>
    </div>
  </div>

  <!-- User Stats Modal -->
  <div class="modal fade" id="userStatsModal" tabindex="-1">
    <div class="modal-dialog modal-xl modal-dialog-scrollable">
      <div class="modal-content rounded-3 shadow">
        <div class="modal-header" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white;">
          <h5 class="modal-title">
            üë§ User Analytics: <span id="userStatsName" class="fw-bold"></span>
          </h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body bg-light">

          <ul class="nav nav-pills mb-3 nav-justified" id="userStatsTabs" role="tablist">
            <li class="nav-item" role="presentation">
              <button class="nav-link active fw-bold" id="daily-tab" data-bs-toggle="tab"
                data-bs-target="#daily-content" type="button" role="tab">
                üìÖ Daily Sales Performance
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link fw-bold" id="history-tab" data-bs-toggle="tab" data-bs-target="#history-content"
                type="button" role="tab">
                üìú Full Transaction History
              </button>
            </li>
          </ul>

          <div class="tab-content" id="userStatsTabContent">

            <!-- Daily Sales Tab -->
            <div class="tab-pane fade show active" id="daily-content" role="tabpanel">
              <div class="card border-0 shadow-sm">
                <div class="card-body p-0">
                  <div class="table-responsive">
                    <table class="table table-striped table-hover mb-0 align-middle">
                      <thead class="bg-light text-secondary">
                        <tr>
                          <th class="py-3 ps-3">Date</th>
                          <th class="py-3 text-center">Tickets Sold</th>
                          <th class="py-3 text-end pe-3">Total Revenue</th>
                        </tr>
                      </thead>
                      <tbody id="userDailyTableBody">
                        <!-- Dynamic content -->
                      </tbody>
                      <tfoot class="bg-light fw-bold">
                        <tr>
                          <td class="ps-3">Total</td>
                          <td class="text-center" id="userDailyTotalQty">0</td>
                          <td class="text-end pe-3" id="userDailyTotalRev">‚Ç±0</td>
                        </tr>
                      </tfoot>
                    </table>
                  </div>
                </div>
              </div>
            </div>

            <!-- History Tab -->
            <div class="tab-pane fade" id="history-content" role="tabpanel">
              <div class="mb-3">
                <input type="text" id="userHistorySearch" class="form-control"
                  placeholder="üîç Search history by ID, Ticket, or Name...">
              </div>
              <div class="card border-0 shadow-sm">
                <div class="card-body p-0">
                  <div class="table-responsive">
                    <table class="table table-striped table-hover mb-0 align-middle" style="font-size: 0.9rem;">
                      <thead class="bg-light text-secondary">
                        <tr>
                          <th class="py-3 ps-3">Time</th>
                          <th class="py-3">School ID</th>
                          <th class="py-3 text-center">Ticket</th>
                          <th class="py-3">Student Name</th>
                          <th class="py-3">Department</th>
                          <th class="py-3">Type</th>
                          <th class="py-3 text-end pe-3">Price</th>
                        </tr>
                      </thead>
                      <tbody id="userHistoryTableBody">
                        <!-- Dynamic content -->
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>

          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="admin.js" type="module"></script>
</body>

</html>